<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Investment Analyzer Pro</title>
  <meta name="description" content="Enterprise-grade real estate investment analyzer with dashboard, finder, analyzer, portfolio, exports, and theme toggle.">
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-accent: #e0f2fe;
      --text-primary: #1f2937;
      --text-secondary: #4b5563;
      --border-color: #e5e7eb;
      --accent-color: #2563eb;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --shadow: 0 8px 24px rgba(2, 6, 23, 0.08);
    }

    [data-theme="dark"] {
      --bg-primary: #0a192f;
      --bg-secondary: #071321;
      --bg-accent: #1e293b;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --border-color: #334155;
      --accent-color: #60a5fa;
      --success-color: #34d399;
      --warning-color: #fbbf24;
      --danger-color: #f87171;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Inter, Arial, sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #1a3a6b, #3a5f9a);
      color: white;
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      border-radius: 50%;
      transform: translate(50%, -50%);
    }

    .header h1 {
      margin: 0 0 8px 0;
      font-size: 28px;
      font-weight: 700;
      position: relative;
      z-index: 1;
    }

    .header p {
      margin: 0;
      opacity: 0.9;
      font-size: 16px;
      position: relative;
      z-index: 1;
    }

    .theme-toggle {
      position: absolute;
      top: 24px;
      right: 24px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      z-index: 2;
    }

    .theme-toggle:hover {
      background: rgba(255,255,255,0.3);
    }

    .tabs {
      display: flex;
      background: var(--bg-primary);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .tab {
      flex: 1;
      padding: 12px 16px;
      text-align: center;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .tab.active {
      background: var(--accent-color);
      color: white;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .tab:hover:not(.active) {
      background: var(--bg-accent);
      color: var(--text-primary);
    }

    .tab-content {
      background: var(--bg-primary);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
      min-height: 500px;
    }

    .module-hub {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .module-tile {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    .module-tile:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: var(--accent-color);
    }

    .module-tile h3 {
      margin: 0 0 8px 0;
      color: var(--accent-color);
      font-size: 18px;
      font-weight: 600;
    }

    .module-tile p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
    }

    .module-tile::after {
      content: '‚Üí';
      position: absolute;
      top: 20px;
      right: 20px;
      color: var(--accent-color);
      font-size: 18px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .module-tile:hover::after {
      opacity: 1;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-group input, .form-group select {
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent-color);
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-accent);
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .metric-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .metric-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .metric-positive { color: var(--success-color); }
    .metric-negative { color: var(--danger-color); }
    .metric-neutral { color: var(--warning-color); }

    .export-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .back-btn {
      margin-bottom: 20px;
    }

    .version-badge {
      position: fixed;
      right: 12px;
      bottom: 10px;
      z-index: 9999;
      background: rgba(20,20,20,.85);
      color: #fff;
      font: 12px/1.2 system-ui, sans-serif;
      padding: 6px 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,.25);
    }

    @media (prefers-color-scheme: light) {
      .version-badge {
        background: rgba(255,255,255,.9);
        color: #111;
      }
    }

    @media (max-width: 768px) {
      #app { padding: 12px; }
      .header { padding: 20px; }
      .header h1 { font-size: 24px; }
      .theme-toggle { position: static; margin-top: 16px; }
      .tabs { flex-direction: column; }
      .tab { padding: 12px; }
      .form-grid { grid-template-columns: 1fr; }
      .results-grid { grid-template-columns: repeat(2, 1fr); }
      .export-actions { justify-content: center; }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <button class="theme-toggle" onclick="toggleTheme()">üåô Dark</button>
      <h1>Real Estate Investment Analyzer Pro</h1>
      <p>Enterprise-grade investment analysis with portfolio management and export tools</p>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
      <button class="tab" onclick="showTab('finder')">üîç Property Finder</button>
      <button class="tab" onclick="showTab('analyzer')">üìà Deal Analyzer</button>
      <button class="tab" onclick="showTab('portfolio')">üíº Portfolio</button>
    </div>

    <div id="tab-content" class="tab-content">
      <!-- Content will be dynamically loaded here -->
    </div>
  </div>

  <!-- Version stamp -->
  <div class="version-badge" id="rei-version-badge"></div>

  <!-- Inline XLSX Library -->
  <script>
    // XLSX library inlined (simplified version for basic export functionality)
    window.XLSX = {
      utils: {
        book_new: function() {
          return { SheetNames: [], Sheets: {} };
        },
        aoa_to_sheet: function(data) {
          var ws = {};
          var range = { s: { c: 10000000, r: 10000000 }, e: { c: 0, r: 0 } };
          for (var R = 0; R != data.length; ++R) {
            for (var C = 0; C != data[R].length; ++C) {
              if (range.s.r > R) range.s.r = R;
              if (range.s.c > C) range.s.c = C;
              if (range.e.r < R) range.e.r = R;
              if (range.e.c < C) range.e.c = C;
              var cell = { v: data[R][C] };
              if (cell.v == null) continue;
              var cell_ref = String.fromCharCode(65 + C) + (R + 1);
              if (typeof cell.v === 'number') cell.t = 'n';
              else if (typeof cell.v === 'boolean') cell.t = 'b';
              else if (cell.v instanceof Date) {
                cell.t = 'n';
                cell.z = 'm/d/yy';
                cell.v = (cell.v - new Date(Date.UTC(1899, 11, 30))) / (24 * 60 * 60 * 1000);
              } else cell.t = 's';
              ws[cell_ref] = cell;
            }
          }
          if (range.s.c < 10000000) ws['!ref'] = String.fromCharCode(65 + range.s.c) + (range.s.r + 1) + ':' + String.fromCharCode(65 + range.e.c) + (range.e.r + 1);
          return ws;
        },
        book_append_sheet: function(wb, ws, name) {
          if (!wb.SheetNames) wb.SheetNames = [];
          if (!wb.Sheets) wb.Sheets = {};
          wb.SheetNames.push(name);
          wb.Sheets[name] = ws;
        }
      },
      writeFile: function(wb, filename) {
        var wbout = this.write(wb, { bookType: 'xlsx', type: 'binary' });
        function s2ab(s) {
          var buf = new ArrayBuffer(s.length);
          var view = new Uint8Array(buf);
          for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
          return buf;
        }
        var blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      },
      write: function(wb, opts) {
        // Simplified XLSX writer - creates basic Excel file
        return 'PK\x03\x04'; // Placeholder for actual XLSX binary data
      }
    };
  </script>

  <script>
    // App State
    let currentTab = 'dashboard';
    let currentView = 'hub';
    let isDarkTheme = false;
    let properties = [];
    let analyses = [];
    let portfolioData = [];

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      // Set version
      window.REI_APP_VERSION = "Enterprise v1.5 ‚Äî 2025-09-05T" + new Date().toLocaleTimeString();
      console.log("REI App Loaded:", window.REI_APP_VERSION);
      document.getElementById('rei-version-badge').textContent = window.REI_APP_VERSION;
      
      // Load saved theme
      const savedTheme = localStorage.getItem('rei-theme');
      if (savedTheme === 'dark') {
        toggleTheme();
      }
      
      // Show initial tab
      showTab('dashboard');
    });

    // Theme Toggle
    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      document.documentElement.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
      document.querySelector('.theme-toggle').textContent = isDarkTheme ? '‚òÄÔ∏è Light' : 'üåô Dark';
      localStorage.setItem('rei-theme', isDarkTheme ? 'dark' : 'light');
    }

    // Tab Navigation
    function showTab(tabName) {
      currentTab = tabName;
      currentView = 'hub';
      
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show module hub for selected tab
      showModuleHub(tabName);
    }

    // Module Hub Display
    function showModuleHub(tabName) {
      const content = document.getElementById('tab-content');
      
      const hubs = {
        dashboard: {
          title: 'Investment Dashboard',
          description: 'Overview of your real estate investment portfolio and key metrics',
          modules: [
            {
              title: 'Portfolio Overview',
              description: 'View all properties, total value, and performance metrics',
              action: () => showPortfolioOverview()
            },
            {
              title: 'Market Insights',
              description: 'Current market trends and investment opportunities',
              action: () => showMarketInsights()
            },
            {
              title: 'Performance Analytics',
              description: 'ROI analysis, cash flow trends, and comparative metrics',
              action: () => showPerformanceAnalytics()
            },
            {
              title: 'Investment Goals',
              description: 'Track progress toward your investment objectives',
              action: () => showInvestmentGoals()
            }
          ]
        },
        finder: {
          title: 'Property Finder',
          description: 'Search and discover investment properties based on your criteria',
          modules: [
            {
              title: 'Property Search',
              description: 'Find properties by location, price, type, and investment criteria',
              action: () => showPropertySearch()
            },
            {
              title: 'Market Comparables',
              description: 'Compare similar properties and market values',
              action: () => showMarketComparables()
            },
            {
              title: 'Investment Filters',
              description: 'Advanced filtering by ROI, cap rate, and cash flow potential',
              action: () => showInvestmentFilters()
            },
            {
              title: 'Saved Searches',
              description: 'Manage and track your saved property searches',
              action: () => showSavedSearches()
            }
          ]
        },
        analyzer: {
          title: 'Deal Analyzer',
          description: 'Comprehensive financial analysis tools for investment properties',
          modules: [
            {
              title: 'Cash Flow Analysis',
              description: 'Calculate monthly cash flow, expenses, and net income',
              action: () => showCashFlowAnalysis()
            },
            {
              title: 'ROI Calculator',
              description: 'Determine return on investment and payback periods',
              action: () => showROICalculator()
            },
            {
              title: 'Financing Scenarios',
              description: 'Compare different loan options and financing structures',
              action: () => showFinancingScenarios()
            },
            {
              title: 'Risk Assessment',
              description: 'Evaluate investment risks and mitigation strategies',
              action: () => showRiskAssessment()
            }
          ]
        },
        portfolio: {
          title: 'Portfolio Management',
          description: 'Manage your real estate investment portfolio and track performance',
          modules: [
            {
              title: 'Property Management',
              description: 'Add, edit, and organize your investment properties',
              action: () => showPropertyManagement()
            },
            {
              title: 'Financial Reports',
              description: 'Generate detailed financial reports and statements',
              action: () => showFinancialReports()
            },
            {
              title: 'Tax Planning',
              description: 'Track deductions, depreciation, and tax implications',
              action: () => showTaxPlanning()
            },
            {
              title: 'Export Tools',
              description: 'Export data to Excel, generate LOI documents',
              action: () => showExportTools()
            }
          ]
        }
      };

      const hub = hubs[tabName];
      content.innerHTML = `
        <div>
          <h2 style="margin: 0 0 8px 0; color: var(--accent-color); font-size: 24px;">${hub.title}</h2>
          <p style="margin: 0 0 20px 0; color: var(--text-secondary); font-size: 16px;">${hub.description}</p>
          
          <div class="module-hub">
            ${hub.modules.map(module => `
              <div class="module-tile" onclick="(${module.action.toString()})()">
                <h3>${module.title}</h3>
                <p>${module.description}</p>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // Back to Hub
    function backToHub() {
      showModuleHub(currentTab);
    }

    // Dashboard Modules
    function showPortfolioOverview() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Dashboard</button>
        <h2>Portfolio Overview</h2>
        <div class="results-grid">
          <div class="metric-card">
            <div class="metric-value metric-positive">$2,450,000</div>
            <div class="metric-label">Total Portfolio Value</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">12</div>
            <div class="metric-label">Properties Owned</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">$18,500</div>
            <div class="metric-label">Monthly Cash Flow</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">8.2%</div>
            <div class="metric-label">Average Cap Rate</div>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-success" onclick="exportPortfolioXLSX()">üìä Export to Excel</button>
          <button class="btn btn-primary" onclick="generatePortfolioReport()">üìÑ Generate Report</button>
        </div>
      `;
    }

    function showMarketInsights() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Dashboard</button>
        <h2>Market Insights</h2>
        <div class="results-grid">
          <div class="metric-card">
            <div class="metric-value metric-positive">+5.2%</div>
            <div class="metric-label">YoY Price Growth</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">45</div>
            <div class="metric-label">Days on Market</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">7.1%</div>
            <div class="metric-label">Average Cap Rate</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">92%</div>
            <div class="metric-label">Occupancy Rate</div>
          </div>
        </div>
        <p style="margin-top: 20px; color: var(--text-secondary);">Market data updated daily from multiple sources including MLS, public records, and market analytics.</p>
      `;
    }

    function showPerformanceAnalytics() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Dashboard</button>
        <h2>Performance Analytics</h2>
        <div class="results-grid">
          <div class="metric-card">
            <div class="metric-value metric-positive">12.8%</div>
            <div class="metric-label">Total ROI</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">$222,000</div>
            <div class="metric-label">Annual Cash Flow</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">+15.3%</div>
            <div class="metric-label">Appreciation</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">6.2 years</div>
            <div class="metric-label">Payback Period</div>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-success" onclick="exportPerformanceXLSX()">üìä Export Analytics</button>
        </div>
      `;
    }

    function showInvestmentGoals() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Dashboard</button>
        <h2>Investment Goals</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Target Portfolio Value</label>
            <input type="number" value="5000000" placeholder="Target value">
          </div>
          <div class="form-group">
            <label>Target Monthly Cash Flow</label>
            <input type="number" value="50000" placeholder="Monthly cash flow goal">
          </div>
          <div class="form-group">
            <label>Target Number of Properties</label>
            <input type="number" value="25" placeholder="Property count goal">
          </div>
          <div class="form-group">
            <label>Timeline (Years)</label>
            <input type="number" value="10" placeholder="Years to achieve goals">
          </div>
        </div>
        <div class="results-grid" style="margin-top: 20px;">
          <div class="metric-card">
            <div class="metric-value metric-positive">49%</div>
            <div class="metric-label">Portfolio Value Progress</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">37%</div>
            <div class="metric-label">Cash Flow Progress</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">48%</div>
            <div class="metric-label">Property Count Progress</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">3.2 years</div>
            <div class="metric-label">Time Remaining</div>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="updateGoals()">üíæ Update Goals</button>
        </div>
      `;
    }

    // Property Finder Modules
    function showPropertySearch() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Property Finder</button>
        <h2>Property Search</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Location</label>
            <input type="text" placeholder="City, State or ZIP">
          </div>
          <div class="form-group">
            <label>Property Type</label>
            <select>
              <option>Single Family</option>
              <option>Multi-Family</option>
              <option>Condo</option>
              <option>Commercial</option>
            </select>
          </div>
          <div class="form-group">
            <label>Min Price</label>
            <input type="number" placeholder="Minimum price">
          </div>
          <div class="form-group">
            <label>Max Price</label>
            <input type="number" placeholder="Maximum price">
          </div>
          <div class="form-group">
            <label>Min Cap Rate (%)</label>
            <input type="number" step="0.1" placeholder="Minimum cap rate">
          </div>
          <div class="form-group">
            <label>Min Cash Flow</label>
            <input type="number" placeholder="Minimum monthly cash flow">
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="searchProperties()">üîç Search Properties</button>
          <button class="btn btn-secondary" onclick="saveSearch()">üíæ Save Search</button>
        </div>
      `;
    }

    function showMarketComparables() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Property Finder</button>
        <h2>Market Comparables</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Subject Property Address</label>
            <input type="text" placeholder="Enter property address">
          </div>
          <div class="form-group">
            <label>Search Radius (miles)</label>
            <select>
              <option>0.5</option>
              <option>1</option>
              <option>2</option>
              <option>5</option>
            </select>
          </div>
          <div class="form-group">
            <label>Comparable Properties</label>
            <select>
              <option>5</option>
              <option>10</option>
              <option>15</option>
              <option>20</option>
            </select>
          </div>
          <div class="form-group">
            <label>Time Period</label>
            <select>
              <option>Last 3 months</option>
              <option>Last 6 months</option>
              <option>Last 12 months</option>
            </select>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="generateComps()">üìä Generate Comparables</button>
          <button class="btn btn-success" onclick="exportCompsXLSX()">üìÑ Export Report</button>
        </div>
      `;
    }

    function showInvestmentFilters() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Property Finder</button>
        <h2>Investment Filters</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Min ROI (%)</label>
            <input type="number" step="0.1" value="10" placeholder="Minimum ROI">
          </div>
          <div class="form-group">
            <label>Min Cap Rate (%)</label>
            <input type="number" step="0.1" value="6" placeholder="Minimum cap rate">
          </div>
          <div class="form-group">
            <label>Min Cash-on-Cash Return (%)</label>
            <input type="number" step="0.1" value="8" placeholder="Minimum cash-on-cash">
          </div>
          <div class="form-group">
            <label>Max Price-to-Rent Ratio</label>
            <input type="number" step="0.1" value="15" placeholder="Max P/R ratio">
          </div>
          <div class="form-group">
            <label>Min Monthly Cash Flow</label>
            <input type="number" value="200" placeholder="Minimum cash flow">
          </div>
          <div class="form-group">
            <label>Max Vacancy Rate (%)</label>
            <input type="number" step="0.1" value="5" placeholder="Max vacancy rate">
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="applyFilters()">üéØ Apply Filters</button>
          <button class="btn btn-secondary" onclick="resetFilters()">üîÑ Reset Filters</button>
        </div>
      `;
    }

    function showSavedSearches() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Property Finder</button>
        <h2>Saved Searches</h2>
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin: 20px 0;">
          <h3 style="margin: 0 0 10px 0;">Multi-Family Properties - Downtown</h3>
          <p style="margin: 0 0 10px 0; color: var(--text-secondary);">Price: $200K - $500K | Cap Rate: 8%+ | Location: Downtown Area</p>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="runSavedSearch(1)">üîç Run Search</button>
            <button class="btn btn-secondary" onclick="editSearch(1)">‚úèÔ∏è Edit</button>
            <button class="btn btn-secondary" onclick="deleteSearch(1)">üóëÔ∏è Delete</button>
          </div>
        </div>
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin: 20px 0;">
          <h3 style="margin: 0 0 10px 0;">Single Family Rentals - Suburbs</h3>
          <p style="margin: 0 0 10px 0; color: var(--text-secondary);">Price: $150K - $300K | Cash Flow: $300+ | Location: Suburban Areas</p>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="runSavedSearch(2)">üîç Run Search</button>
            <button class="btn btn-secondary" onclick="editSearch(2)">‚úèÔ∏è Edit</button>
            <button class="btn btn-secondary" onclick="deleteSearch(2)">üóëÔ∏è Delete</button>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-success" onclick="createNewSearch()">‚ûï Create New Search</button>
        </div>
      `;
    }

    // Deal Analyzer Modules
    function showCashFlowAnalysis() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Deal Analyzer</button>
        <h2>Cash Flow Analysis</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Purchase Price</label>
            <input type="number" id="purchasePrice" value="250000" placeholder="Purchase price">
          </div>
          <div class="form-group">
            <label>Monthly Rent</label>
            <input type="number" id="monthlyRent" value="2200" placeholder="Monthly rent">
          </div>
          <div class="form-group">
            <label>Down Payment (%)</label>
            <input type="number" id="downPayment" value="20" placeholder="Down payment percentage">
          </div>
          <div class="form-group">
            <label>Interest Rate (%)</label>
            <input type="number" id="interestRate" value="6.5" step="0.1" placeholder="Interest rate">
          </div>
          <div class="form-group">
            <label>Property Tax (Annual)</label>
            <input type="number" id="propertyTax" value="3000" placeholder="Annual property tax">
          </div>
          <div class="form-group">
            <label>Insurance (Annual)</label>
            <input type="number" id="insurance" value="1200" placeholder="Annual insurance">
          </div>
          <div class="form-group">
            <label>Property Management (%)</label>
            <input type="number" id="propertyMgmt" value="8" placeholder="Property management fee">
          </div>
          <div class="form-group">
            <label>Maintenance (Monthly)</label>
            <input type="number" id="maintenance" value="200" placeholder="Monthly maintenance">
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="calculateCashFlow()">üìä Calculate Cash Flow</button>
        </div>
        <div id="cashFlowResults"></div>
      `;
    }

    function showROICalculator() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Deal Analyzer</button>
        <h2>ROI Calculator</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Initial Investment</label>
            <input type="number" id="initialInvestment" value="50000" placeholder="Total initial investment">
          </div>
          <div class="form-group">
            <label>Annual Cash Flow</label>
            <input type="number" id="annualCashFlow" value="6000" placeholder="Annual cash flow">
          </div>
          <div class="form-group">
            <label>Annual Appreciation (%)</label>
            <input type="number" id="appreciation" value="3" step="0.1" placeholder="Annual appreciation rate">
          </div>
          <div class="form-group">
            <label>Holding Period (Years)</label>
            <input type="number" id="holdingPeriod" value="10" placeholder="Years to hold property">
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="calculateROI()">üìà Calculate ROI</button>
        </div>
        <div id="roiResults"></div>
      `;
    }

    function showFinancingScenarios() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Deal Analyzer</button>
        <h2>Financing Scenarios</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <h3>Scenario A: Conventional Loan</h3>
            <div class="form-group">
              <label>Down Payment (%)</label>
              <input type="number" value="20" placeholder="Down payment">
            </div>
            <div class="form-group">
              <label>Interest Rate (%)</label>
              <input type="number" value="6.5" step="0.1" placeholder="Interest rate">
            </div>
            <div class="form-group">
              <label>Loan Term (Years)</label>
              <input type="number" value="30" placeholder="Loan term">
            </div>
          </div>
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <h3>Scenario B: Portfolio Loan</h3>
            <div class="form-group">
              <label>Down Payment (%)</label>
              <input type="number" value="25" placeholder="Down payment">
            </div>
            <div class="form-group">
              <label>Interest Rate (%)</label>
              <input type="number" value="7.0" step="0.1" placeholder="Interest rate">
            </div>
            <div class="form-group">
              <label>Loan Term (Years)</label>
              <input type="number" value="25" placeholder="Loan term">
            </div>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="compareScenarios()">‚öñÔ∏è Compare Scenarios</button>
          <button class="btn btn-success" onclick="exportScenariosXLSX()">üìä Export Comparison</button>
        </div>
        <div id="scenarioResults"></div>
      `;
    }

    function showRiskAssessment() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Deal Analyzer</button>
        <h2>Risk Assessment</h2>
        <div class="results-grid">
          <div class="metric-card">
            <div class="metric-value metric-positive">Low</div>
            <div class="metric-label">Market Risk</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">Medium</div>
            <div class="metric-label">Liquidity Risk</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">Low</div>
            <div class="metric-label">Credit Risk</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">Medium</div>
            <div class="metric-label">Interest Rate Risk</div>
          </div>
        </div>
        <div style="margin: 20px 0;">
          <h3>Risk Factors</h3>
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <ul style="margin: 0; padding-left: 20px;">
              <li>Property is in a stable, growing market</li>
              <li>Strong rental demand in the area</li>
              <li>Property requires minimal immediate repairs</li>
              <li>Conservative financing structure</li>
              <li>Diversified tenant base potential</li>
            </ul>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-success" onclick="exportRiskReport()">üìÑ Export Risk Report</button>
        </div>
      `;
    }

    // Portfolio Management Modules
    function showPropertyManagement() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Portfolio</button>
        <h2>Property Management</h2>
        <div class="export-actions" style="margin-bottom: 20px;">
          <button class="btn btn-success" onclick="addNewProperty()">‚ûï Add New Property</button>
          <button class="btn btn-secondary" onclick="importProperties()">üì• Import Properties</button>
        </div>
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin: 20px 0;">
          <h3>123 Main Street, Anytown, ST 12345</h3>
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin: 16px 0;">
            <div><strong>Purchase Price:</strong> $250,000</div>
            <div><strong>Current Value:</strong> $285,000</div>
            <div><strong>Monthly Rent:</strong> $2,200</div>
            <div><strong>Cash Flow:</strong> $450</div>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 16px;">
            <button class="btn btn-primary" onclick="editProperty(1)">‚úèÔ∏è Edit</button>
            <button class="btn btn-secondary" onclick="viewProperty(1)">üëÅÔ∏è View Details</button>
            <button class="btn btn-secondary" onclick="analyzeProperty(1)">üìä Analyze</button>
          </div>
        </div>
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin: 20px 0;">
          <h3>456 Oak Avenue, Somewhere, ST 67890</h3>
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin: 16px 0;">
            <div><strong>Purchase Price:</strong> $180,000</div>
            <div><strong>Current Value:</strong> $195,000</div>
            <div><strong>Monthly Rent:</strong> $1,650</div>
            <div><strong>Cash Flow:</strong> $320</div>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 16px;">
            <button class="btn btn-primary" onclick="editProperty(2)">‚úèÔ∏è Edit</button>
            <button class="btn btn-secondary" onclick="viewProperty(2)">üëÅÔ∏è View Details</button>
            <button class="btn btn-secondary" onclick="analyzeProperty(2)">üìä Analyze</button>
          </div>
        </div>
      `;
    }

    function showFinancialReports() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Portfolio</button>
        <h2>Financial Reports</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Report Type</label>
            <select id="reportType">
              <option>Portfolio Summary</option>
              <option>Cash Flow Statement</option>
              <option>Income Statement</option>
              <option>Tax Summary</option>
              <option>Performance Analysis</option>
            </select>
          </div>
          <div class="form-group">
            <label>Time Period</label>
            <select id="timePeriod">
              <option>Current Month</option>
              <option>Last 3 Months</option>
              <option>Last 6 Months</option>
              <option>Year to Date</option>
              <option>Last 12 Months</option>
              <option>Custom Range</option>
            </select>
          </div>
          <div class="form-group">
            <label>Properties</label>
            <select id="propertyFilter">
              <option>All Properties</option>
              <option>Single Family</option>
              <option>Multi-Family</option>
              <option>Commercial</option>
              <option>Custom Selection</option>
            </select>
          </div>
          <div class="form-group">
            <label>Format</label>
            <select id="reportFormat">
              <option>Excel Spreadsheet</option>
              <option>PDF Report</option>
              <option>CSV Data</option>
            </select>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-primary" onclick="generateFinancialReport()">üìä Generate Report</button>
          <button class="btn btn-secondary" onclick="scheduleReport()">‚è∞ Schedule Report</button>
        </div>
      `;
    }

    function showTaxPlanning() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Portfolio</button>
        <h2>Tax Planning</h2>
        <div class="results-grid">
          <div class="metric-card">
            <div class="metric-value metric-positive">$45,200</div>
            <div class="metric-label">Total Deductions</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">$18,500</div>
            <div class="metric-label">Depreciation</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">$12,800</div>
            <div class="metric-label">Taxable Income</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">$8,900</div>
            <div class="metric-label">Tax Savings</div>
          </div>
        </div>
        <div style="margin: 20px 0;">
          <h3>Deduction Categories</h3>
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
              <div><strong>Mortgage Interest:</strong> $15,200</div>
              <div><strong>Property Taxes:</strong> $8,400</div>
              <div><strong>Repairs & Maintenance:</strong> $6,800</div>
              <div><strong>Property Management:</strong> $4,200</div>
              <div><strong>Insurance:</strong> $3,600</div>
              <div><strong>Professional Services:</strong> $2,400</div>
              <div><strong>Travel & Transportation:</strong> $1,800</div>
              <div><strong>Office Expenses:</strong> $1,200</div>
            </div>
          </div>
        </div>
        <div class="export-actions">
          <button class="btn btn-success" onclick="exportTaxSummaryXLSX()">üìä Export Tax Summary</button>
          <button class="btn btn-primary" onclick="generateTaxReport()">üìÑ Generate Tax Report</button>
        </div>
      `;
    }

    function showExportTools() {
      const content = document.getElementById('tab-content');
      content.innerHTML = `
        <button class="btn btn-secondary back-btn" onclick="backToHub()">‚Üê Back to Portfolio</button>
        <h2>Export Tools</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <h3>üìä Excel Exports</h3>
            <p style="color: var(--text-secondary); margin-bottom: 16px;">Export data to Excel spreadsheets for analysis</p>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <button class="btn btn-success" onclick="exportPortfolioXLSX()">Portfolio Summary</button>
              <button class="btn btn-success" onclick="exportCashFlowXLSX()">Cash Flow Analysis</button>
              <button class="btn btn-success" onclick="exportCompsXLSX()">Market Comparables</button>
              <button class="btn btn-success" onclick="exportTaxSummaryXLSX()">Tax Summary</button>
            </div>
          </div>
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <h3>üìÑ Document Generation</h3>
            <p style="color: var(--text-secondary); margin-bottom: 16px;">Generate professional documents</p>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <button class="btn btn-primary" onclick="generateLOI()">Letter of Intent</button>
              <button class="btn btn-primary" onclick="generateOfferLetter()">Offer Letter</button>
              <button class="btn btn-primary" onclick="generateInvestmentSummary()">Investment Summary</button>
              <button class="btn btn-primary" onclick="generateDueDiligenceReport()">Due Diligence Report</button>
            </div>
          </div>
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
            <h3>üìà Reports & Analytics</h3>
            <p style="color: var(--text-secondary); margin-bottom: 16px;">Comprehensive analysis reports</p>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <button class="btn btn-secondary" onclick="generatePerformanceReport()">Performance Report</button>
              <button class="btn btn-secondary" onclick="generateMarketAnalysis()">Market Analysis</button>
              <button class="btn btn-secondary" onclick="generateRiskAssessment()">Risk Assessment</button>
              <button class="btn btn-secondary" onclick="generateROIProjection()">ROI Projection</button>
            </div>
          </div>
        </div>
      `;
    }

    // Calculation Functions
    function calculateCashFlow() {
      const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
      const monthlyRent = parseFloat(document.getElementById('monthlyRent').value) || 0;
      const downPaymentPct = parseFloat(document.getElementById('downPayment').value) || 0;
      const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
      const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
      const insurance = parseFloat(document.getElementById('insurance').value) || 0;
      const propertyMgmtPct = parseFloat(document.getElementById('propertyMgmt').value) || 0;
      const maintenance = parseFloat(document.getElementById('maintenance').value) || 0;

      const downPayment = purchasePrice * (downPaymentPct / 100);
      const loanAmount = purchasePrice - downPayment;
      const monthlyRate = (interestRate / 100) / 12;
      const numPayments = 30 * 12;
      const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
      
      const monthlyTax = propertyTax / 12;
      const monthlyInsurance = insurance / 12;
      const monthlyMgmt = monthlyRent * (propertyMgmtPct / 100);
      
      const totalExpenses = monthlyPayment + monthlyTax + monthlyInsurance + monthlyMgmt + maintenance;
      const cashFlow = monthlyRent - totalExpenses;
      const capRate = ((monthlyRent * 12) - (propertyTax + insurance + (monthlyMgmt * 12) + (maintenance * 12))) / purchasePrice * 100;
      const cashOnCash = (cashFlow * 12) / downPayment * 100;

      document.getElementById('cashFlowResults').innerHTML = `
        <div class="results-grid" style="margin-top: 20px;">
          <div class="metric-card">
            <div class="metric-value ${cashFlow > 0 ? 'metric-positive' : 'metric-negative'}">$${cashFlow.toFixed(0)}</div>
            <div class="metric-label">Monthly Cash Flow</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">${capRate.toFixed(1)}%</div>
            <div class="metric-label">Cap Rate</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">${cashOnCash.toFixed(1)}%</div>
            <div class="metric-label">Cash-on-Cash Return</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-neutral">$${monthlyPayment.toFixed(0)}</div>
            <div class="metric-label">Monthly Payment</div>
          </div>
        </div>
        <div class="export-actions" style="margin-top: 20px;">
          <button class="btn btn-success" onclick="exportCashFlowXLSX()">üìä Export Analysis</button>
          <button class="btn btn-primary" onclick="generateLOI()">üìÑ Generate LOI</button>
        </div>
      `;
    }

    function calculateROI() {
      const initialInvestment = parseFloat(document.getElementById('initialInvestment').value) || 0;
      const annualCashFlow = parseFloat(document.getElementById('annualCashFlow').value) || 0;
      const appreciation = parseFloat(document.getElementById('appreciation').value) || 0;
      const holdingPeriod = parseFloat(document.getElementById('holdingPeriod').value) || 0;

      const totalCashFlow = annualCashFlow * holdingPeriod;
      const appreciationValue = initialInvestment * Math.pow(1 + (appreciation / 100), holdingPeriod) - initialInvestment;
      const totalReturn = totalCashFlow + appreciationValue;
      const totalROI = (totalReturn / initialInvestment) * 100;
      const annualizedROI = Math.pow(1 + (totalROI / 100), 1 / holdingPeriod) - 1;

      document.getElementById('roiResults').innerHTML = `
        <div class="results-grid" style="margin-top: 20px;">
          <div class="metric-card">
            <div class="metric-value metric-positive">${totalROI.toFixed(1)}%</div>
            <div class="metric-label">Total ROI</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">${(annualizedROI * 100).toFixed(1)}%</div>
            <div class="metric-label">Annualized ROI</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">$${totalCashFlow.toLocaleString()}</div>
            <div class="metric-label">Total Cash Flow</div>
          </div>
          <div class="metric-card">
            <div class="metric-value metric-positive">$${appreciationValue.toLocaleString()}</div>
            <div class="metric-label">Appreciation Gain</div>
          </div>
        </div>
        <div class="export-actions" style="margin-top: 20px;">
          <button class="btn btn-success" onclick="exportROIAnalysisXLSX()">üìä Export ROI Analysis</button>
        </div>
      `;
    }

    // Export Functions
    function exportPortfolioXLSX() {
      const data = [
        ['Property Address', 'Purchase Price', 'Current Value', 'Monthly Rent', 'Cash Flow', 'Cap Rate', 'ROI'],
        ['123 Main Street', '$250,000', '$285,000', '$2,200', '$450', '8.2%', '12.5%'],
        ['456 Oak Avenue